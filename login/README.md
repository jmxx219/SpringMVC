# 로그인 처리

> [상품 관리 시스템](https://github.com/jmxx219/Spring-Study/blob/main/item-service/README.md) 프로젝트에 로그인 기능을 구현해보자  
> [쿠키와 세션 설명 참고](https://github.com/jmxx219/CS-Study/blob/main/Network/%EC%BF%A0%ED%82%A4%EC%99%80%20%EC%84%B8%EC%85%98.md)

### 목차
  - [쿠키](#쿠키)


<br/>

### 패키지 구조 설계

**package 구조**
- hello.login 
  - domain 
    - item 
    - member 
    - login
  - web 
    - item
    - member
    - login

**도메인**

- 화면, UI, 기술 인프라 등등의 영역을 제외한 시스템이 구현해야 하는 핵심 비즈니스 업무 영역
- 향후 web을 다른 기술로 바꾸어도 도메인은 그대로 유지할 수 있어야 함
  - web은 domain을 알고있지만(의존), domain은 web을 모르도록(의존 X) 설계
  
  
---

<br/>

## 쿠키

- 로그인 상태 유지
  - 서버에서 로그인에 성공하면 HTTP 응답에 쿠키를 담아서 브라우저에 전달
  - 브라우저는 해당 쿠키를 다음 요청 때마다 지속해서 보내줌
- 종류
  - 영속 쿠키: 만료 날짜를 입력하면 해당 날짜까지 유지
  - 세션 쿠키: 만료 날짜를 생략하면 브라우저 종료시 까지만 유지
- 사용
  - 로그인 성공
    - 쿠키 생성
    ```java
    Cookie idCookie = new Cookie("memberId", String.valueOf(loginMember.getId()));
    response.addCookie(idCookie);
    ```
    - 세션 쿠키가 지속해서 유지
  - 웹 브라우저에서 서버에 요청 시 쿠키를 계속 보내줌
    - `@CookieValue`를 이용하여 편리하게 쿠키 조회 가능
  - 로그아웃 시, 서버에서 해당 쿠키의 종료 날짜를 0으로 지정하여 쿠키 종

**보안 문제**

- 쿠키 값은 임의로 변경할 수 있음
  - 클라이언트가 쿠키를 강제로 변경하면 다른 사용자가 될 수 있음
  - 실제 웹브라우저 개발자 모드 ➙ Application ➙ Cookie 변경으로 확인
- 쿠키에 보관된 정보는 훔쳐갈 수 있음
  - 쿠키에 개인정보나, 신용카드 정보 등이 있을 경우
    - 해당 정보가 웹 브라우저에도 보관되고, 네트워크 요청마다 계속 클라이언트에서 버로 전달됨
    - 쿠키의 정보가 나의 로컬 PC에서 털릴 수 도 있고, 네트워크 전송 구간에서도 털릴 수 있음
- 해커가 쿠키를 한 번 훔쳐가면 평생 사용할 수 있음
  - 해커가 쿠키를 훔쳐가 해당 쿠키로 악의적인 요청을 계속 시도할 수 있음

**대안**
- 쿠키에 중요한 값을 노출하지 않고, 사용자별로 예측 불가능한 임의의 토큰(랜덤 값)을 노출함
  - 서버에서 토큰과 사용자 id를 매핑해서 인식하고, 서버에서 토큰을 관리함
- 토큰은 해커가 임의의 값을 넣어도 찾을 수 없도록 예측 불가능해야 함
- 해커가 토큰을 털어가도 시간이 지나면 사용할 수 없도록 서버에서 토큰의 만료시간을 짧게 유지해야 함
  - 해킹이 의심되는 경우, 서버에서 해당 토큰을 강제로 제거

<br/>

